(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{439:function(s,t,a){"use strict";a.r(t);var n=a(20),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"关于陀螺仪的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于陀螺仪的使用"}},[s._v("#")]),s._v(" 关于陀螺仪的使用")]),s._v(" "),a("h2",{attrs:{id:"前景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前景"}},[s._v("#")]),s._v(" 前景")]),s._v(" "),a("p",[s._v("在做个人首页的时候，PC端做了一个 跟随鼠标旋转的效果，但是在移动端时，又没有鼠标，那么旋转要根据什么判断呢？")]),s._v(" "),a("p",[s._v("于是想到了，可以判断重力感应 (陀螺仪) 来实现旋转")]),s._v(" "),a("p",[s._v("也是因为种种原因，最后在 移动端，是以小球来做的跟随陀螺仪的移动")]),s._v(" "),a("h2",{attrs:{id:"技术"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#技术"}},[s._v("#")]),s._v(" 技术")]),s._v(" "),a("p",[s._v("这里主要用到的 api 为 "),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/DeviceOrientationEvent",target:"_blank",rel:"noopener noreferrer"}},[s._v("DeviceOrientationEvent"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("code",[s._v("DeviceOrientationEvent")]),s._v(" 会返回当前设备在浏览页面是的物理旋转信息")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/assets/axes.png")}}),s._v(" "),a("p",[s._v("我们这里会用到的信息主要有 3 个")]),s._v(" "),a("p",[a("code",[s._v("alpha")]),s._v(": 一个表示设备绕 z 轴旋转的角度（范围在 0-360 之间）的数字")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/assets/alpha.png")}}),s._v(" "),a("p",[a("code",[s._v("beta")]),s._v(": 一个表示设备绕 x 轴旋转（范围在－180 到 180 之间）的数字，从前到后的方向为正方向。")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/assets/beta.png")}}),s._v(" "),a("p",[a("code",[s._v("gamma")]),s._v(": 一个表示设备绕 y 轴旋转（范围在－90 到 90 之间）的数字，从左向右为正方向。")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/assets/gamma.png")}}),s._v(" "),a("p",[s._v("而 做小球跟随陀螺仪移动的效果，我们只需要用到 "),a("code",[s._v("beta")]),s._v(" 和 "),a("code",[s._v("gamma")])]),s._v(" "),a("h2",{attrs:{id:"实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[s._v("#")]),s._v(" 实现")]),s._v(" "),a("p",[s._v("首先我们需要监听 "),a("code",[s._v("DeviceOrientationEvent")]),s._v(" 事件，来获取到 陀螺仪的信息")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deviceorientation"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" handleOrientation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleOrientation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("beta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// range [-180,180]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gamma"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// range [-90,90]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("监听获取到 陀螺仪的 信息之后，这里可以拿到 "),a("code",[s._v("beta")]),s._v(" 和 "),a("code",[s._v("gamma")]),s._v(" 的值")]),s._v(" "),a("p",[s._v("可以看到 beta 在 -180 和 180 之间， gamma 在 -90 到 90 之间")]),s._v(" "),a("p",[s._v("我们可以通过 chrome 的模拟器来模拟一下 这些角度下，手机都是什么状态")]),s._v(" "),a("p",[s._v("通过 chrome 的 sensors 可以来模拟手机陀螺仪，开启方法如下")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/assets/sensors.png")}}),s._v(" "),a("p",[s._v("打开之后可以看到会出现手机的模拟状态")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/assets/sensors_1.png")}}),s._v(" "),a("p",[s._v("可以看到 在 "),a("code",[s._v("beta")]),s._v(" "),a("code",[s._v("90°")]),s._v(" 时，手机是竖直向下的")]),s._v(" "),a("p",[s._v("我们可以试着调整角度来模拟不同的状态")]),s._v(" "),a("p",[s._v("我们调整 "),a("code",[s._v("gamma")]),s._v(" 的角度来看看手机的情况")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/assets/sensors_2.png")}}),s._v(" "),a("p",[a("strong",[s._v("可以看到，在 70° 时，手机是向右旋转的，同理可以推算 90°时，手机正面完全转到右侧，反之如果度数为负值，则是向左旋转")])]),s._v(" "),a("p",[s._v("接着调整 "),a("code",[s._v("beta")]),s._v(" 的角度来观察手机的状态")]),s._v(" "),a("p",[s._v("旋转 "),a("code",[s._v("20°")])]),s._v(" "),a("img",{attrs:{src:s.$withBase("/assets/sensors_3.png")}}),s._v(" "),a("p",[s._v("旋转 "),a("code",[s._v("150°")])]),s._v(" "),a("img",{attrs:{src:s.$withBase("/assets/sensors_4.png")}}),s._v(" "),a("p",[s._v("旋转 "),a("code",[s._v("-20°")])]),s._v(" "),a("img",{attrs:{src:s.$withBase("/assets/sensors_5.png")}}),s._v(" "),a("p",[s._v("可以看到 0-180 是属于手机正面的旋转角度")]),s._v(" "),a("p",[s._v("-180 - 0 则是手机背面的")]),s._v(" "),a("p",[s._v("对此，我们这里采用的事手机正面的陀螺仪 ，背面的则不做处理，至此，我们已经拿到了 手机的角度，以及各个角度所表达的意思，那么接下来就是 小球以及小球动画的问题")]),s._v(" "),a("h2",{attrs:{id:"小球及动画"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小球及动画"}},[s._v("#")]),s._v(" 小球及动画")]),s._v(" "),a("p",[s._v("这里我创建了一个 小球，默认就当做是在屏幕的正中央，宽度为 "),a("code",[s._v("20vmin")])]),s._v(" "),a("p",[s._v("首先拿到设备的宽和高")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("  viewportH "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innerHeight "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("documentElement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clientHeight\n  viewportW "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innerWidth "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("documentElement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clientWidth\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("接着确定小球的宽度，我这里是使用 "),a("code",[s._v("border")]),s._v(" 实现的，所以取 0.1 即可")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("_ball "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" viewportH "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" viewportW "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" viewportW "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" viewportH "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此时就确定了，小球的直径，以及获取到了设备的宽高，接着我们要确定一些安全距离")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    maxX "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" viewportW "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" ballSize\n    maxY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" viewportH "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" ballSize\n    midX "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" maxX "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    midY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" maxY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("我们是通过 left 和 top 来修改小球的位置的，那么 "),a("code",[s._v("left")]),s._v(" 最大的值，则就是 "),a("strong",[s._v("设备宽度 减去 小球的直径")]),s._v("，top 同理")]),s._v(" "),a("p",[s._v("这里同时也取到了 中位数，也就是小球默认所处的位置 "),a("code",[s._v("left")]),s._v(" 和 "),a("code",[s._v("top")]),s._v(" 的值")]),s._v(" "),a("p",[s._v("这些是我们获取到的初始状态，那么此时就可以根据这些值 还有 陀螺仪的角度来对应修改小球的位置")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("  window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deviceorientation"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" handleOrientation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleOrientation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("beta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gamma"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    ball"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("css")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      top"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" midY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" maxY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"px"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      left"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" midX "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" maxX "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"px"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("首先 对于 x 也就是 beta 的值做了一个修正，我们取 -90 - 90 之间的度数，也就是手机 正面朝上 然后 上下倾斜的度数")]),s._v(" "),a("p",[s._v("对此就做了一个修正")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("接着 可以看到 "),a("code",[s._v("x")]),s._v(" 和 "),a("code",[s._v("y")]),s._v(" 都是 180 度的跨度，那么 就除以 "),a("code",[s._v("180")]),s._v("，拿到当前度数对应的距离，得到的值有正有负")]),s._v(" "),a("p",[s._v("通过之前得出的 中位数 "),a("code",[s._v("midY")]),s._v(" 和 "),a("code",[s._v("midX")]),s._v(" ，来算出 上下左右的偏移，同步修改 "),a("code",[s._v("ball")]),s._v(" 所对应的 "),a("code",[s._v("css")]),s._v(" 即可")]),s._v(" "),a("p",[s._v("至此，正常的陀螺仪小球动画就完成了，当然也有很多其他的效果，可以自己尝试一下")]),s._v(" "),a("h2",{attrs:{id:"ios-设备的相关问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ios-设备的相关问题"}},[s._v("#")]),s._v(" iOS 设备的相关问题")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("iOS")]),s._v(" 中，按照上述步骤完成后，是不能实现小球动画的，那是因为 "),a("code",[s._v("iOS")]),s._v(" 的陀螺仪做了一定的限制")]),s._v(" "),a("ol",[a("li",[s._v("项目的地址必须是 "),a("code",[s._v("https")]),s._v(" 协议")]),s._v(" "),a("li",[s._v("在 iOS 13+ ，需要申请用户权限 "),a("code",[s._v("window.DeviceOrientationEvent.requestPermission()")]),s._v("， 返回值是个 "),a("code",[s._v("promise")]),s._v("，"),a("code",[s._v("promise")]),s._v(" 中会返回 用户的  允许（“"),a("code",[s._v("granted")]),s._v("”）/ 拒绝（”"),a("code",[s._v("denied")]),s._v("“） 状态；")]),s._v(" "),a("li",[a("code",[s._v("requestPermission")]),s._v(" 方法的 "),a("strong",[s._v("首次")]),s._v(" 调用 需要 由用户交互触发（目前发现 "),a("code",[s._v("click")]),s._v("，"),a("code",[s._v("touchend")]),s._v(" 事件可以）\n"),a("ul",[a("li",[s._v("先说下  "),a("strong",[s._v("首次")]),s._v(" 的含义。指的是用户 完全退出 "),a("code",[s._v("app")]),s._v("（而不是 app 切换到后台运行） 后再次打开为首次。用户在首次进入后 如果页面需要陀螺仪权限，需要用户交互才能触发 "),a("code",[s._v("requestPermission")]),s._v(" 方法。之后系统会记录 用户对本网址的授权信息，不退出 "),a("code",[s._v("app")]),s._v(" 的情况下就不需要重复申请本权限了，本记录信息会一直保留  直到完全退出 "),a("code",[s._v("app")]),s._v("。")]),s._v(" "),a("li",[s._v("非首次调用的话  则不需要用户交互 触发，我们在页面初始化时调用来拿到 用户的 授权状态  进而做一些处理。")]),s._v(" "),a("li",[s._v("如果首次调用 不是由 用户触发，比如 页面初始化时 调用，则此方法的 "),a("code",[s._v("promise")]),s._v(" 会返回 "),a("code",[s._v("reject")]),s._v(" 状态")])])])]),s._v(" "),a("p",[s._v("基于以上问题，对于 ios 端做一定的兼容处理，将事件绑定在 "),a("code",[s._v("body")]),s._v(" 上")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    isIOS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("userAgent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("(iPhone|iPad|iPod|iOS)")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-flags"}},[s._v("i")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("isIOS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typeof")]),s._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DeviceMotionEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("requestPermission "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'function'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("one")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'body'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DeviceMotionEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("requestPermission")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("permissionState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("permissionState "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'granted'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deviceorientation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" handleOrientation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deviceorientation"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" handleOrientation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("对于 iOS 没有点击授权之前，可以考虑做一个小球自动反弹的动画，那个是后话了，或者加一点其他的状态，提醒用户点击授权等等 ~")])])}),[],!1,null,null,null);t.default=e.exports}}]);